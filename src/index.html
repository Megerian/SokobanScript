<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>The Sokoban Game</title>

    <!-- PWA: theme color for browser UI -->
    <meta name="theme-color" content="#2185d0">

    <!-- PWA: web app manifest -->
    <link rel="manifest" href="./manifest.webmanifest">


    <!-- Fomantic UI CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/fomantic-ui/dist/semantic.min.css">

    <!-- App styles -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>

<!-- Sidebar with snapshots/solutions -->
<div class="ui sidebar" id="snapshotSidebar">

    <!-- Header -->
    <h1 class="ui header" id="snapshotListHeader">
        <div class="content">Saved states</div>
    </h1>

    <!-- Filter buttons -->
    <div class="snapshot-filter-buttons">
        <button
                class="ui tiny compact primary button active"
                id="filterSolutionsButton"
                title="Toggle visibility of solutions"
        >
            <i class="star icon"></i>Solutions
        </button>
        <button
                class="ui tiny compact primary button active"
                id="filterSnapshotsButton"
                title="Toggle visibility of snapshots"
        >
            <i class="camera icon"></i>Snapshots
        </button>
    </div>

    <!-- Scrollable list of snapshots/solutions -->
    <div class="ui selection divided list" id="snapshotList">
        <!-- Items are added here dynamically -->
    </div>

    <!-- Action buttons at the bottom (sticky footer inside sidebar) -->
    <div id="snapshotSidebarButtons">
        <button class="ui center labeled icon button" id="saveSnapshotButton">
            <i class="save icon"></i>
            Save snapshot
        </button>

        <button
                class="ui center labeled icon button"
                id="importLURDString"
                title="Import a LURD string as snapshot or solution"
        >
            <i class="paste icon"></i>
            Import snapshot
        </button>
    </div>
</div>

<!-- Pusher: content that moves when the sidebar is visible -->
<div id="pusher" class="pusher">

    <!-- Top menu bar -->
    <div class="ui top attached menu">
        <div class="ui container">

            <!-- Puzzle menu -->
            <div class="ui simple dropdown item">
                <i class="grid layout icon"></i> Puzzle
                <i class="dropdown icon"></i>

                <div class="menu">
                    <div class="item" id="importPuzzleFromFile">
                        <i class="folder open icon"></i> Import puzzle from file
                    </div>

                    <div class="item" id="importPuzzleFromClipboard">
                        <i class="paste icon"></i> Import puzzle from clipboard
                    </div>

                    <div class="item" id="exportPuzzleFromClipboard">
                        <i class="copy icon"></i> Export puzzle to clipboard
                    </div>
                </div>
            </div>

            <!-- Moves menu -->
            <div class="ui simple dropdown item">
                <i class="barcode icon"></i> Moves
                <i class="dropdown icon"></i>

                <div class="menu">
                    <div class="item" id="copyMovesAsString">
                        <i class="barcode icon"></i> Copy moves to clipboard
                    </div>

                    <div class="item" id="pasteMovesFromClipboard">
                        <i class="paste icon"></i> Paste moves from clipboard
                    </div>
                </div>
            </div>

            <!-- Settings menu -->
            <div class="ui simple dropdown item">
                <i class="settings icon"></i> Settings <i class="dropdown icon"></i>

                <div class="menu">

                    <!-- View als Untermenü innerhalb von Settings -->
                    <div class="ui dropdown item">
                        <i class="eye icon"></i> View <i class="dropdown icon"></i>
                        <div class="menu">

                            <!-- Skin -->
                            <div class="ui dropdown item">
                                <i class="images icon"></i> Skin <i class="dropdown icon"></i>
                                <div class="menu">
                                    <div data-skinName="AntiqueDesk"  class="item">AntiqueDesk by Gerry Wiseman</div>
                                    <div data-skinName="AntiqueDesk3" class="item">AntiqueDesk3 by Gerry Wiseman</div>
                                    <div data-skinName="HeavyMetal3"  class="item">HeavyMetal3 by Gerry Wiseman</div>
                                    <div data-skinName="NightShift3"  class="item">NightShift3 by Gerry Wiseman</div>
                                    <div data-skinName="SokoGems"     class="item">SokoGems by Gerry Wiseman</div>
                                    <div data-skinName="KSokoban"     class="item">KSokoban by Anders Widell</div>
                                    <div data-skinName="KenBri"       class="item">KenBri by Kenney Vleugels &amp; Brian Damgaard</div>
                                    <div data-skinName="KSokoban2"    class="item active selected">
                                        KSokoban by Anders W./George Petrov
                                    </div>
                                </div>
                            </div>

                            <!-- Graphic size -->
                            <div class="ui dropdown item">
                                <i class="expand arrows alternate icon"></i>
                                Graphic size
                                <i class="dropdown icon"></i>
                                <div class="menu">
                                    <div data-skinGraphicSize="auto" class="item active selected">automatic</div>
                                    <div data-skinGraphicSize="16"   class="item">16px</div>
                                    <div data-skinGraphicSize="24"   class="item">24px</div>
                                    <div data-skinGraphicSize="32"   class="item">32px</div>
                                    <div data-skinGraphicSize="40"   class="item">40px</div>
                                    <div data-skinGraphicSize="48"   class="item">48px</div>
                                    <div data-skinGraphicSize="56"   class="item">56px</div>
                                    <div data-skinGraphicSize="64"   class="item">64px</div>
                                    <div data-skinGraphicSize="72"   class="item">72px</div>
                                    <div data-skinGraphicSize="80"   class="item">80px</div>
                                    <div data-skinGraphicSize="88"   class="item">88px</div>
                                    <div data-skinGraphicSize="96"   class="item">96px</div>
                                    <div data-skinGraphicSize="104"  class="item">104px</div>
                                    <div data-skinGraphicSize="112"  class="item">112px</div>
                                    <div data-skinGraphicSize="120"  class="item">120px</div>
                                </div>
                            </div>

                            <!-- Animation settings -->
                            <div class="ui dropdown item">
                                <i class="running icon"></i> Animations <i class="dropdown icon"></i>

                                <div class="menu">
                                    <!-- Move animation delay -->
                                    <div class="ui dropdown item">
                                        <i class="dropdown icon"></i><i class="stopwatch icon"></i>
                                        Move animation delay
                                        <div class="ui menu">
                                            <div data-moveAnimationDelay="0"   class="item">0ms</div>
                                            <div data-moveAnimationDelay="10"  class="item">10ms</div>
                                            <div data-moveAnimationDelay="20"  class="item">20ms</div>
                                            <div data-moveAnimationDelay="30"  class="item">30ms</div>
                                            <div data-moveAnimationDelay="40"  class="item">40ms</div>
                                            <div data-moveAnimationDelay="50"  class="item active selected">50ms</div>
                                            <div data-moveAnimationDelay="60"  class="item">60ms</div>
                                            <div data-moveAnimationDelay="70"  class="item">70ms</div>
                                            <div data-moveAnimationDelay="80"  class="item">80ms</div>
                                            <div data-moveAnimationDelay="90"  class="item">90ms</div>
                                            <div data-moveAnimationDelay="100" class="item">100ms</div>
                                            <div data-moveAnimationDelay="110" class="item">110ms</div>
                                            <div data-moveAnimationDelay="120" class="item">120ms</div>
                                            <div data-moveAnimationDelay="130" class="item">130ms</div>
                                            <div data-moveAnimationDelay="140" class="item">140ms</div>
                                            <div data-moveAnimationDelay="150" class="item">150ms</div>
                                            <div data-moveAnimationDelay="160" class="item">160ms</div>
                                            <div data-moveAnimationDelay="170" class="item">170ms</div>
                                            <div data-moveAnimationDelay="180" class="item">180ms</div>
                                            <div data-moveAnimationDelay="190" class="item">190ms</div>
                                            <div data-moveAnimationDelay="200" class="item">200ms</div>
                                        </div>
                                    </div>

                                    <div class="ui divider"></div>

                                    <!-- Selected object animation speed -->
                                    <div class="ui dropdown item">
                                        <i class="dropdown icon"></i><i class="stopwatch icon"></i>
                                        Selected object animation speed
                                        <div class="menu">
                                            <div data-selectedObjectAnimationDelay="10"   class="item">10%</div>
                                            <div data-selectedObjectAnimationDelay="20"   class="item">20%</div>
                                            <div data-selectedObjectAnimationDelay="30"   class="item">30%</div>
                                            <div data-selectedObjectAnimationDelay="40"   class="item">40%</div>
                                            <div data-selectedObjectAnimationDelay="50"   class="item">50%</div>
                                            <div data-selectedObjectAnimationDelay="60"   class="item">60%</div>
                                            <div data-selectedObjectAnimationDelay="70"   class="item">70%</div>
                                            <div data-selectedObjectAnimationDelay="80"   class="item">80%</div>
                                            <div data-selectedObjectAnimationDelay="90"   class="item">90%</div>
                                            <div data-selectedObjectAnimationDelay="100"  class="item active selected">100%</div>
                                            <div data-selectedObjectAnimationDelay="110"  class="item">110%</div>
                                            <div data-selectedObjectAnimationDelay="120"  class="item">120%</div>
                                            <div data-selectedObjectAnimationDelay="130"  class="item">130%</div>
                                            <div data-selectedObjectAnimationDelay="140"  class="item">140%</div>
                                            <div data-selectedObjectAnimationDelay="150"  class="item">150%</div>
                                            <div data-selectedObjectAnimationDelay="160"  class="item">160%</div>
                                            <div data-selectedObjectAnimationDelay="170"  class="item">170%</div>
                                            <div data-selectedObjectAnimationDelay="180"  class="item">180%</div>
                                            <div data-selectedObjectAnimationDelay="190"  class="item">190%</div>
                                            <div data-selectedObjectAnimationDelay="200"  class="item">200%</div>
                                        </div>
                                    </div>

                                    <!-- Toggle animation on/off -->
                                    <div class="item">
                                        <i class="running icon"></i>
                                        <div class="ui checkbox">
                                            <input type="checkbox" id="showAnimations" checked>
                                            <label for="showAnimations">Show animation</label>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Background color/image -->
                            <div class="ui dropdown item">
                                <i class="palette icon"></i> Background <i class="dropdown icon"></i>
                                <div class="menu">

                                    <div class="header">Background color</div>

                                    <div class="item">
                                        <i class="tint icon"></i>
                                        <label for="backgroundColor">Set new color</label>
                                        <input type="color" value="#EBEDEF" id="backgroundColor">
                                    </div>

                                    <!-- Default color -->
                                    <div class="item" id="setDefaultBackgroundColor">
                                        <i class="tint icon"></i>
                                        Set default color
                                    </div>
                                </div>
                            </div>

                            <!-- Snapshot list toggle -->
                            <div class="item">
                                <i class="list ul icon"></i>
                                <div class="ui checkbox">
                                    <input type="checkbox" id="showSnapshotListCheckbox">
                                    <label for="showSnapshotListCheckbox">Show saved states</label>
                                </div>
                            </div>

                            <!-- Hide walls -->
                            <div class="item">
                                <i class="eye slash outline icon"></i>
                                <div class="ui checkbox">
                                    <input type="checkbox" id="hideWalls">
                                    <label for="hideWalls">Hide walls</label>
                                </div>
                            </div>

                            <!-- Ruler toggle -->
                            <div class="item">
                                <i class="ruler horizontal icon"></i>
                                <div class="ui checkbox">
                                    <input type="checkbox" id="showRuler">
                                    <label for="showRuler">Show ruler (A/B/C, 1/2/3)</label>
                                </div>
                            </div>

                        </div> <!-- /View .menu -->
                    </div> <!-- /View dropdown item -->


                    <div class="divider"></div>

                    <!-- Sound -->
                    <a class="item">
                        <i class="volume up icon"></i>
                        <div class="ui checkbox">
                            <input type="checkbox" id="soundEnabled" checked>
                            <label for="soundEnabled">Sound</label>
                        </div>
                    </a>

                </div> <!-- /Settings .menu -->
            </div> <!-- /Settings dropdown item -->

            <!-- Letslogic menu -->
            <div class="ui simple dropdown item">
                <i class="cloud upload icon"></i> Letslogic <i class="dropdown icon"></i>

                <div class="menu">
                    <div class="item" id="letslogicSetApiKey">
                        <i class="key icon"></i> Set API key
                    </div>

                    <div class="item" id="letslogicSubmitCurrent">
                        <i class="upload icon"></i> Submit solutions of current puzzle
                    </div>

                    <div class="item" id="letslogicSubmitCollection">
                        <i class="upload icon"></i> Submit solutions of all collection puzzles
                    </div>
                </div>
            </div>

            <!-- Database menu -->
            <div class="ui simple dropdown item" id="databaseMenu">
                <i class="database icon"></i> Saved Puzzles <i class="dropdown icon"></i>
                <div class="menu">
                    <div class="header">Statistics</div>
                    <div class="item">
                        Puzzles: <span id="databaseBoardsCount">0</span>
                    </div>
                    <div class="item">
                        Solutions: <span id="databaseSolutionsCount">0</span>
                    </div>
                    <div class="item">
                        Snapshots: <span id="databaseSnapshotsCount">0</span>
                    </div>

                    <div class="divider"></div>

                    <div class="item" id="databaseExport">
                        <i class="download icon"></i> Export data
                    </div>
                </div>
            </div>

            <!-- Info menu -->
            <div class="ui simple dropdown item">
                <i class="info icon"></i> Info
                <div class="menu">
                    <div class="item" id="howToPlay">
                        <i class="gamepad icon"></i> How to play
                    </div>

                    <!-- About -->
                    <a class="item">
                        Sokoban for JavaScript ver. 0.73
                    </a>
                </div>
            </div>

            <!-- Modal: Letslogic API key -->
            <div class="ui modal" id="letslogicApiKeyModal">
                <div class="header">
                    Letslogic API key
                </div>

                <div class="content">
                    <p>
                        Please enter your Letslogic API key.
                    </p>
                    <p>
                        You can view and manage your API key on the
                        <a href="https://www.letslogic.com/member/preferences"
                           target="_blank"
                           rel="noopener">
                            Letslogic preferences page
                        </a>.
                    </p>

                    <div class="ui form">
                        <div class="field">
                            <label for="letslogicApiKeyInput">API key</label>
                            <input id="letslogicApiKeyInput"
                                   type="text"
                                   placeholder="Paste your Letslogic API key here">
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <div class="ui deny button">Cancel</div>
                    <div class="ui primary positive button" id="letslogicApiKeySaveButton">
                        Save API key
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Main app area -->
    <div id="appDiv">
        <!-- Left side: collection + puzzle selectors, stats -->
        <div>
            <!-- Collection & puzzle selectors -->
            <div class="ui cards selector">
                <div class="card">
                    <div class="content">
                        <div class="ui form">
                            <div class="field">
                                <label for="collectionSelector">Collection:</label>
                                <select class="ui search dropdown" id="collectionSelector">
                                    <option value="Mini Cosmos.sok">Aymeric du Peloux 1 Mini Cosmos</option>
                                    <option value="Micro Cosmos.sok">Aymeric du Peloux 2 Micro Cosmos</option>
                                    <option value="Nabo Cosmos.sok">Aymeric du Peloux 3 Nabo Cosmos</option>
                                    <option value="Pico Cosmos.sok">Aymeric du Peloux 4 Pico Cosmos</option>
                                    <option value="Cosmopoly.sok">Aymeric du Peloux 5 Cosmopoly</option>
                                    <option value="Cosmonotes.sok">Aymeric du Peloux Cosmonotes</option>
                                    <option value="Myrio Cosmos.sok">Aymeric du Peloux Myrio Cosmos</option>
                                    <option value="Disciple.sok">Jean-Pierre Martel Disciple</option>
                                    <option value="Grigr 2001.sok">GRIGoRusha 2001</option>
                                    <option value="Grigr 2002.sok">GRIGoRusha 2002</option>
                                    <option value="Grigr Challenge.sok">GRIGoRusha Challenge</option>
                                    <option value="Grigr Special.sok">GRIGoRusha Special</option>
                                    <option value="Grigr Star.sok">GRIGoRusha Star</option>
                                    <option value="Grigr Sun.sok">GRIGoRusha Sun</option>
                                    <option value="SokEvo.sok">Lee J Haywood SokEvo</option>
                                    <option value="YASGen.sok">Brian Damgaard YASGen</option>
                                </select>
                            </div>

                            <div class="field">
                                <label for="puzzleSelector">Puzzle:</label>
                                <select class="ui search dropdown" id="puzzleSelector">
                                    <option value="1">1 - Puzzle 1</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats: moves / pushes -->
            <div class="ui cards selector">
                <div class="card">
                    <div class="content">
                        <div class="ui two column centered grid">
                            <div class="ui statistics">
                                <div class="blue statistic" style="min-width:50px">
                                    <div class="value">
                                        <span id="moves">0</span>
                                    </div>
                                    <div class="label">Moves</div>
                                </div>
                                <div class="blue statistic" style="min-width:50px">
                                    <div class="value">
                                        <span id="pushes">0</span>
                                    </div>
                                    <div class="label">Pushes</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right side: toolbar + canvas + status bar -->
        <div id="buttonsAndCanvasDIV">

            <!-- Toolbar -->
            <div class="toolbarButtons" id="toolbarButtons">
                <button class="ui icon button" title="Undo all" id="undoAllButton">
                    <i class="angle double left icon"></i>
                </button>
                <button class="ui icon button" title="Undo" id="undoButton">
                    <i class="angle left icon"></i>
                </button>
                <button class="ui icon button" title="Redo" id="redoButton">
                    <i class="angle right icon"></i>
                </button>
                <button class="ui icon button" title="Redo all" id="redoAllButton">
                    <i class="angle double right icon"></i>
                </button>
            </div>

            <!-- Canvas + solved overlay -->
            <div id="canvasDIV">

                <div id="boardWithRulers">
                    <!-- oberer Ruler (Spalten A, B, C, …) -->
                    <div id="boardRulerTop"></div>

                    <!-- linker Ruler (Zeilen 1, 2, 3, …) + Canvas -->
                    <div id="boardRulerLeftAndCanvas">
                        <div id="boardRulerLeft"></div>
                        <canvas id="canvas"></canvas>
                    </div>
                </div>

                <div id="puzzleSolvedDiv" style="visibility: hidden">
                    <div class="ui dimmer active dot">
                        <h2 class="ui inverted icon header">
                            <i class="thumbs up outline icon"></i>
                            Puzzle solved!
                        </h2>
                    </div>
                </div>

                <!-- Status bar below board -->
                <label id="statusTextLabel" class="ui hidden message">
                    Status: <span id="statusText"></span>
                </label>
            </div>

        </div>
    </div>

    <!-- Modal: invalid board -->
    <div class="ui modal" id="showInvalidBoard">
        <div class="header">
            Invalid board found
        </div>
        <div class="ui segment">
            Found valid board strings:
            <div class="ui segment">
                <pre style="font-family: 'Courier', monospace" id="boardAsString"></pre>
            </div>
            <pre style="color: red" id="boardErrorMessage"></pre>
        </div>

        <div class="actions">
            <div class="ui primary positive button">OK</div>
        </div>
    </div>

    <!-- Modal: How to play -->
    <div class="ui modal" id="showHowToPlay">
        <div class="header">
            <h1>How to play</h1>
        </div>

        <div style="padding: 40px">
            <div class="ui tiny header">
                <h3>Sokoban</h3>
                The puzzle game where you push boxes or crates around in a warehouse,
                trying to get them to storage locations.
            </div>

            <div class="ui segment">
                <h3>Using the keyboard:</h3>
                You can move the player using the arrow keys for moving the player up, down, left and right.<br>
                Alternatively you can use the keys: w, a, s, d or i, j, k, l.
            </div>

            <div class="ui segment">
                <h3>Using the mouse:</h3>
                Click at a free position to let the player move to that position. <br><br>
                Click a box to select it and then click at the target position for that box
                to let the player push that box to that target position.
            </div>
        </div>

        <div class="actions">
            <div class="ui primary positive button">OK</div>
        </div>
    </div>

    <!-- Modal: Letslogic submission progress -->
    <div class="ui modal" id="letslogicProgressModal">
        <div class="header">
            Letslogic submission
        </div>

        <div class="content">
            <div id="letslogicProgressStatus" class="ui small header">
                Preparing submission…
            </div>

            <pre id="letslogicProgressLog" class="letslogic-progress-log"
                 style="max-height: 300px; overflow-y: auto; background: #f9f9f9; padding: 0.75em;">
        </pre>
        </div>

        <div class="actions">
            <div class="ui primary button" id="letslogicProgressCloseButton">
                Close
            </div>
        </div>
    </div>

    <!-- Modal: paste from clipboard (fallback when direct access is not available) -->
    <div class="ui modal" id="pasteFromClipboardDialog">
        <div class="header">
            <h1>Please paste clipboard content</h1>
        </div>

        <div class="ui segment">
            <label for="pastedClipboardContent">Clipboard content:</label>
            <br>
            <textarea id="pastedClipboardContent" style="height: 200px" placeholder="Paste content here"></textarea>
        </div>

        <div class="actions">
            <div class="ui deny button">Cancel</div>
            <div class="ui primary positive button">
                Import content
            </div>
        </div>
    </div>

    <!-- Sounds -->
    <audio id="moveSound"        preload><source src="/src/assets/sound/move.wav" /></audio>
    <audio id="pushSound"        preload><source src="/src/assets/sound/push.wav" /></audio>
    <audio id="pushToGoalSound"  preload><source src="/src/assets/sound/pushToGoal.wav" /></audio>
    <audio id="moveBlockedSound" preload><source src="/src/assets/sound/moveBlocked.wav" /></audio>
    <audio id="solvedSound"      preload><source src="/src/assets/sound/solved.wav" /></audio>

    <!-- Hidden file input used to load a puzzle from disk -->
    <input
            type="file"
            id="puzzleFileInput"
            accept=".txt,.sok,.xsb"
            style="display: none"
    />

    <!-- Context menu for snapshots/solutions -->
    <div id="snapshotContextMenu" class="ui vertical menu custom-context-menu">
        <div class="item" id="contextSetSnapshot">
            <i class="play icon"></i>
            Set state on board
        </div>
        <div class="item" id="contextCopySnapshot">
            <i class="copy icon"></i>
            Copy LURD to clipboard
        </div>
        <div class="item" id="contextDeleteSnapshot">
            <i class="trash icon"></i>
            Delete snapshot / solution
        </div>
    </div>

    <!-- jQuery + Fomantic JS -->
    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fomantic-ui/dist/semantic.min.js"></script>

    <!-- LocalForage -->
    <script src="https://cdn.jsdelivr.net/npm/localforage/dist/localforage.min.js"></script>

    <!-- Main app entry point -->
    <script type="module" src="sokoban.ts"></script>

</div> <!-- end pusher -->

</body>
</html>
